{"remainingRequest":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/src/components/elements/fields/InputImage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/src/components/elements/fields/InputImage.vue","mtime":1570632960898},{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/andrey/Документы/Andrgit/Study/Golang/Operations-Manager/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ReloadIcon from 'icons/Reload.svg'\nimport ImageElement from '@/components/elements/ImageElement.vue';\nexport default {\n    name: 'InputImage',\n    componentName: 'InputImage',\n    components: {\n        ImageElement,\n        ReloadIcon,\n    },\n    props: {\n        value: {\n            type: Object,\n            default: null\n        },\n        label: String,\n        style_component: {\n            type: Object,\n            default: null\n        },\n        isError: {\n            type: Boolean,\n            defaul: false\n        },\n        disabled: {\n            type: Boolean,\n            defaul: false\n        },\n        paramsText: {\n            type: Array,\n            default: null\n        },\n        maxSize: {\n            type: Number,\n            default: null\n        }\n    },\n    data() {\n        return {\n            isDownload: false,\n            percentLoad: 0,\n            idObject: '',\n            curValue: null\n        }\n    },\n    created(){\n        console.log(\"CREATED INPUT IMAGE\");\n        this.$store.commit('incObjectID');\n        this.idObject = this.$store.getters.getObjectID;\n        // this.updateCounter(this.value);\n    },\n    watch: {\n        value: {\n            handler(newValue, oldValue) {\n                this.curValue = newValue;\n            },\n            immediate: true\n        }\n    },\n    computed: {\n        isImage(){\n            return !!this.curValue || this.isDownload;\n        },\n        nameImage() {\n            let result = null;\n            if (!!this.curValue &&\n                this.curValue.hasOwnProperty('original') &&\n                Object.prototype.toString.call(this.curValue.original) === '[object String]') {\n                let arr = this.curValue.original.split('/');\n                result = arr[arr.length - 1];\n                // result = this.value.src.replace(/.+\\/(\\w+)$/, \"$1\");\n            }\n            return result;\n        },\n        paramsImage() {\n            let result = [];\n            if (!!this.curValue) {\n                if (!!this.curValue.size) {\n                    let str = this.$t('$fields.file_size');\n                    let sizeKB = this.curValue.size / 1024; \n                    if (sizeKB < 1024) {\n                        result.push(`${ str }: ${ Math.round(sizeKB) } ${ this.$t('$common.types_calculus.KB') }`);\n                    } else {\n                        result.push(`${ str }: ${ Math.round(sizeKB / 1024) } ${ this.$t('$common.types_calculus.MB') }`);\n                    }\n                }\n                if (!!this.curValue.width && !!this.curValue.height) {\n                    result.push(`${ this.$t('$fields.resolution') } ${ this.curValue.width }x${ this.curValue.height } ${ this.$t('$common.types_calculus.PX') }`);\n                }\n            }\n            return result.length === 0 ? null : result;\n        }\n    //     nameImage(){\n    //         let arr = !!this.value ? this.value.src.split('/') : [,''];\n    //         return arr[arr.length - 1];\n    //     }\n    },\n    methods: {\n        uploadImage(event) {\n            console.log(\"[InputImage.vue]: uploadImage: \", event);\n            if (event.target.files.length > 0) {\n                let file = event.target.files[0];\n                if (this.maxSize !== null) {\n                    if (file.size > this.maxSize) {\n                        this.$store.commit('addNotification', { \n                            text: `${ this.$t('$notifications.download_size_exceeds') } ${ this.maxSize / 1024 } ${ this.$t('$common.types_calculus.KB') }`, \n                            color: 'red' \n                        });\n                        return;\n                    }\n                }\n\n                let formData = new FormData();\n                formData.append(\"image\", file);\n                this.isDownload = true;\n                this.percentLoad = 0;\n                this.curValue = null;\n                this.postData(formData);\n            }\n\n    //         let formData = new FormData();\n    //         formData.append(\"file\", event.target.files[0]);\n    //         this.isDownload = true;\n    //         this.percentLoad = 0;\n\n    //         axios.post('graphql/uploadImage', formData, {\n    //             baseURL: process.env.NODE_ENV === 'development' ? 'https://beta.relocus.ru/' : 'https://beta.relocus.ru/',\n    //             headers:{ token: \"f2392211114629558002b9011e4dc057\" }, \n    //             onUploadProgress: this.onUploadProgress \n    //         }).then(response => {\n    //             //console.log(response);\n    //             if (response.status === 200){\n    //                 this.$emit('input', response.data);\n    //                 setTimeout(() => {\n    //                     this.isDownload = false;\n    //                 }, 1000)\n    //             }\n    //         }).catch(error => {\n    //             //console.log(error);\n    //             setTimeout(() => {\n    //                 this.isDownload = false;\n    //             }, 1000)\n    //         });\n\n\n        },\n        postData(dataPost) {\n            this.$store.state.axios.post('/upload', dataPost, { \n                'baseURL': `${ this.$store.state.APP_SERVER_ADDRESS }/api/v${ this.$store.state.APP_VERSION_API }`,\n                onUploadProgress: this.onUploadProgress\n            }).then(response => {\n                console.log(\"[InputImage.vue]: postData(response) :\", response);\n                if (response.status === 200){\n                    this.$emit('input', response.data);\n                    setTimeout(() => {\n                        this.isDownload = false;\n                    }, 1000)\n                }\n            }).catch(error => {\n                console.log(\"[InputImage.vue]: postData(error): \", error);\n                setTimeout(() => {\n                    this.isDownload = false;\n                }, 1000)\n                this.curValue = this.value;\n            })\n        },\n        onUploadProgress(progressEvent){\n            this.percentLoad = (progressEvent.loaded / progressEvent.total) * 100;\n        },\n    }\n}\n",{"version":3,"sources":["InputImage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InputImage.vue","sourceRoot":"src/components/elements/fields","sourcesContent":["<template lang=\"pug\">\ndiv.input-image(\n    :class=`[\n        (!!style_component && !!style_component.class) ? style_component.class : '',\n        { 'is-disabled': disabled }\n    ]`\n)\n    span.regular.font-body.input-image__label(\n        v-if=\"!!label\"\n        :class=\"{ 'error': (isError && curValue === null) }\"\n    ) {{ label }}\n    div.input-image__image-block.back_grey2(v-if=\"isImage\").flex\n        div.input-image__image-back(v-if=\"isDownload\")\n            el-progress(\n                v-if=\"isDownload\"\n                type=\"circle\" \n                :percentage=\"percentLoad\"\n                :width=\"30\"\n            )\n        image-element.input-image__image-back(v-else :data=\"curValue\")\n        div.input-image__params-image.break-all-block.mh-60()\n            p.input-image__name-file.regular.font-body.limited-text-line.black(v-if=\"!!nameImage\") {{ nameImage }}\n            template(v-if=\"!!paramsImage\")\n                p.regular.font-desc.limited-text-line.grey50(\n                    v-for=\"(text, index) in paramsImage\"\n                    :key=\"index\"\n                ) {{ text }}\n        label.input-image__icon-update.cursor-pointer.block(:for=\"idObject\" v-if=\"!disabled && !isDownload\")\n            reload-icon\n    div.input-image__button-block.flex.back_grey2(v-else)\n        label.input-image__button.btn-grey.black.block.text-center(:for=\"idObject\") {{ $t('$fields.choose_file') }}\n        div.input-image__params-image.break-all-block.mh-40(v-if=\"!!paramsText\")\n            p.regular.font-desc.limited-text-line.grey50(\n                v-for=\"(text, indexText) in paramsText\"\n                :key=\"indexText\"\n            ) {{ text }}\n    input.input-image__input(\n        ref=\"imageInput\"\n        type=\"file\"\n        accept=\".jpg,.jpeg,.png\"\n        @input=\"uploadImage\"\n        :disabled=\"disabled\"\n        :id=\"idObject\"\n    )\n    //- div.there-image(v-if=\"isImage\")\n    //-     div.image-block(\n    //-         v-if=\"isDownload\"\n    //-     )\n    //-         el-progress(\n    //-             v-if=\"isDownload\"\n    //-             type=\"circle\" \n    //-             :percentage=\"percentLoad\"\n    //-             :width=\"30\"\n    //-         )\n    //-     image-element.image-block(\n    //-         :data=\"value\"\n    //-         v-else\n    //-     )\n            \n    //-     div.param-image\n    //-         p.font-style-regular.font-body.name--(v-if=\"!!value && !!value.src\") {{ nameImage }} \n    //-         p.font-style-regular.font-desc(v-if=\"!!this.value && !!value.size\") File size: {{ value.size }} KB\n    //-         p.font-style-regular.font-desc(v-if=\"!!this.value && !!value.width\") Resulution: {{ value.width }} x {{ value.height }} PX\n    //-     div.icon-update(@click=\"$refs.fileInput.click()\" v-if=\"!options.disabled\")\n    //-         input(ref=\"fileInput\" type=\"file\" accept=\".jpg,.png\" @change=\"uploadImage($event)\")\n    //-         reload-icon\n    //-     div.icon-delete(@click=\"deleteImage\" v-if=\"!options.disabled\")\n    //-         trash-icon\n</template>\n\n<script>\nimport ReloadIcon from 'icons/Reload.svg'\nimport ImageElement from '@/components/elements/ImageElement.vue';\nexport default {\n    name: 'InputImage',\n    componentName: 'InputImage',\n    components: {\n        ImageElement,\n        ReloadIcon,\n    },\n    props: {\n        value: {\n            type: Object,\n            default: null\n        },\n        label: String,\n        style_component: {\n            type: Object,\n            default: null\n        },\n        isError: {\n            type: Boolean,\n            defaul: false\n        },\n        disabled: {\n            type: Boolean,\n            defaul: false\n        },\n        paramsText: {\n            type: Array,\n            default: null\n        },\n        maxSize: {\n            type: Number,\n            default: null\n        }\n    },\n    data() {\n        return {\n            isDownload: false,\n            percentLoad: 0,\n            idObject: '',\n            curValue: null\n        }\n    },\n    created(){\n        console.log(\"CREATED INPUT IMAGE\");\n        this.$store.commit('incObjectID');\n        this.idObject = this.$store.getters.getObjectID;\n        // this.updateCounter(this.value);\n    },\n    watch: {\n        value: {\n            handler(newValue, oldValue) {\n                this.curValue = newValue;\n            },\n            immediate: true\n        }\n    },\n    computed: {\n        isImage(){\n            return !!this.curValue || this.isDownload;\n        },\n        nameImage() {\n            let result = null;\n            if (!!this.curValue &&\n                this.curValue.hasOwnProperty('original') &&\n                Object.prototype.toString.call(this.curValue.original) === '[object String]') {\n                let arr = this.curValue.original.split('/');\n                result = arr[arr.length - 1];\n                // result = this.value.src.replace(/.+\\/(\\w+)$/, \"$1\");\n            }\n            return result;\n        },\n        paramsImage() {\n            let result = [];\n            if (!!this.curValue) {\n                if (!!this.curValue.size) {\n                    let str = this.$t('$fields.file_size');\n                    let sizeKB = this.curValue.size / 1024; \n                    if (sizeKB < 1024) {\n                        result.push(`${ str }: ${ Math.round(sizeKB) } ${ this.$t('$common.types_calculus.KB') }`);\n                    } else {\n                        result.push(`${ str }: ${ Math.round(sizeKB / 1024) } ${ this.$t('$common.types_calculus.MB') }`);\n                    }\n                }\n                if (!!this.curValue.width && !!this.curValue.height) {\n                    result.push(`${ this.$t('$fields.resolution') } ${ this.curValue.width }x${ this.curValue.height } ${ this.$t('$common.types_calculus.PX') }`);\n                }\n            }\n            return result.length === 0 ? null : result;\n        }\n    //     nameImage(){\n    //         let arr = !!this.value ? this.value.src.split('/') : [,''];\n    //         return arr[arr.length - 1];\n    //     }\n    },\n    methods: {\n        uploadImage(event) {\n            console.log(\"[InputImage.vue]: uploadImage: \", event);\n            if (event.target.files.length > 0) {\n                let file = event.target.files[0];\n                if (this.maxSize !== null) {\n                    if (file.size > this.maxSize) {\n                        this.$store.commit('addNotification', { \n                            text: `${ this.$t('$notifications.download_size_exceeds') } ${ this.maxSize / 1024 } ${ this.$t('$common.types_calculus.KB') }`, \n                            color: 'red' \n                        });\n                        return;\n                    }\n                }\n\n                let formData = new FormData();\n                formData.append(\"image\", file);\n                this.isDownload = true;\n                this.percentLoad = 0;\n                this.curValue = null;\n                this.postData(formData);\n            }\n\n    //         let formData = new FormData();\n    //         formData.append(\"file\", event.target.files[0]);\n    //         this.isDownload = true;\n    //         this.percentLoad = 0;\n\n    //         axios.post('graphql/uploadImage', formData, {\n    //             baseURL: process.env.NODE_ENV === 'development' ? 'https://beta.relocus.ru/' : 'https://beta.relocus.ru/',\n    //             headers:{ token: \"f2392211114629558002b9011e4dc057\" }, \n    //             onUploadProgress: this.onUploadProgress \n    //         }).then(response => {\n    //             //console.log(response);\n    //             if (response.status === 200){\n    //                 this.$emit('input', response.data);\n    //                 setTimeout(() => {\n    //                     this.isDownload = false;\n    //                 }, 1000)\n    //             }\n    //         }).catch(error => {\n    //             //console.log(error);\n    //             setTimeout(() => {\n    //                 this.isDownload = false;\n    //             }, 1000)\n    //         });\n\n\n        },\n        postData(dataPost) {\n            this.$store.state.axios.post('/upload', dataPost, { \n                'baseURL': `${ this.$store.state.APP_SERVER_ADDRESS }/api/v${ this.$store.state.APP_VERSION_API }`,\n                onUploadProgress: this.onUploadProgress\n            }).then(response => {\n                console.log(\"[InputImage.vue]: postData(response) :\", response);\n                if (response.status === 200){\n                    this.$emit('input', response.data);\n                    setTimeout(() => {\n                        this.isDownload = false;\n                    }, 1000)\n                }\n            }).catch(error => {\n                console.log(\"[InputImage.vue]: postData(error): \", error);\n                setTimeout(() => {\n                    this.isDownload = false;\n                }, 1000)\n                this.curValue = this.value;\n            })\n        },\n        onUploadProgress(progressEvent){\n            this.percentLoad = (progressEvent.loaded / progressEvent.total) * 100;\n        },\n    }\n}\n</script>\n\n<style lang=\"scss\">\n\n.input-image {\n    &__input {\n        display: none;\n    }\n    &__label {\n        padding: 10px 0;\n    }\n    &__button {\n        width: 170px;\n        height: 40px;\n        box-sizing: border-box;\n        padding: 9px;\n    }\n    &__params-image {\n        flex: 1;\n        margin-left: 20px;\n    }\n    &__image-block {\n        border: 1px solid $grey10;\n        padding: 9px;\n        height: 144px;\n    }\n    &__button-block {\n        border: 1px solid $grey10;\n        padding: 19px;\n        height: 40px;\n    }\n    &__name-file {\n        margin-top: 10px;\n    }\n    &__image-back {\n        width: 120px;\n        height: 144px;\n        position: relative;\n        & .el-progress {\n            position: absolute;\n            top: calc(50% - 15px);\n            left: calc(50% - 15px);\n            .el-progress__text {\n                display: none;\n            }\n            .el-progress-circle__path {\n                stroke-width: 10;\n                stroke: $grey50;\n            }\n        }\n    }\n    &__icon-update {\n        // display: inline-block\n        //     position: relative\n        //     vertical-align: top\n        //     margin: 10px 10px 0 0\n        //     cursor: pointer\n        & .reload-icon-- {\n            stroke: $grey33;\n        }\n        &:hover {\n            & .reload-icon-- {\n                stroke: $grey50;\n            }\n        }\n        &:active {\n            & .reload-icon-- {\n                stroke: $black;\n            }\n        }\n    }\n    &.is-disabled {\n        .input-image__label {\n            color: $grey50;\n        }\n        .input-image__button {\n            cursor: not-allowed;\n            border: 1px solid $grey10;\n            color: $grey50;\n            &:hover, &:active {\n                background-color: $grey2;\n                border: 1px solid $grey10;\n                color: $grey50;\n            }\n        }\n    }\n}\n// .disabled\n//     .span--\n//         color: $grey50\n//     .add-image-button\n//         cursor: not-allowed\n//         border: 1px solid $grey10\n//         color: $grey50\n//         &:hover, &:active\n//             background-color: $grey2\n//             border: 1px solid $grey10\n//             color: $grey50 */\n\n\n</style>"]}]}